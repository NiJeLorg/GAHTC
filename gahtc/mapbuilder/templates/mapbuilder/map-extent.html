{% extends 'website/base.html' %} 
{% load staticfiles %} 

{% block head_js_block %}
<script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_API_KEY }}" async defer></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
 integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
 crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
 integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
 crossorigin=""></script>
 <script type="text/javascript" src="https://unpkg.com/leaflet-geosearch@2.6.0/dist/bundle.min.js"></script>
 <script src='https://unpkg.com/leaflet.gridlayer.googlemutant@latest/Leaflet.GoogleMutant.js'></script>
 <link  href="https://unpkg.com/leaflet-geosearch@latest/assets/css/leaflet.css" rel="stylesheet" />
 <script type="text/javascript" src="http://heyman.github.io/leaflet-areaselect/src/leaflet-areaselect.js"></script>
 <link rel="stylesheet" href="https://heyman.github.io/leaflet-areaselect/src/leaflet-areaselect.css">
 <script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-image/v0.0.4/leaflet-image.js'></script>
{% endblock %}

{% block css_block %}
<link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}" >
{% endblock%}
  
{% block content%}
  <div class="map-header">
    <h3 class="map-header-text"><strong>Pre historic Australia </strong></h3>
    <a class="button step-button"  href="{% url 'mapbuilder:map-export' %}" >Done</a>
  </div>
  <div id="map"></div>
    <div class="layer-switcher">
      <button class="layer-buttons" id="btn1">Terrain</button>
      <button class="layer-buttons button-active" id="btn2">Political</button>
      <button class="layer-buttons" id="btn3">Satellite</button>
    </div>
  <script>

      var lat = localStorage.getItem('lat');
      var long = localStorage.getItem('long');
      var center = [lat, long]

      // initialize the map
      var map = L.map('map', {
          center: center,
          zoom:5,
      })
      
      var marker = L.marker(center).addTo(map);
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        // maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: '{{ MAPBOX_ACCESS_TOKEN }}'
    }).addTo(map);

    
        
    // Add it to the map
    var areaSelect = L.areaSelect({width:300, height:200});
    areaSelect.addTo(map);

    // Read the bounding box
    var bounds = areaSelect.getBounds();
    localStorage.setItem('zoom', map.getZoom());
    localStorage.setItem('bounds', JSON.stringify(bounds));
    
   
    areaSelect.on("change", function() {
        var bounds=this.getBounds();
        localStorage.setItem('zoom', map.getZoom());
        localStorage.setItem('bounds', JSON.stringify(bounds));
    });
   


    // Toggle Between layers
    $('.layer-buttons').click(function(e) {       
        $('.layer-buttons').removeClass('button-active');    
        $(this).addClass('button-active');
        if (this.id == 'btn1') {
        $(this).addClass('button-active');
        var roads = L.gridLayer.googleMutant({
            type: 'terrain'
        }).addTo(map);
        } else if (this.id == 'btn2'){
        var roads = L.gridLayer.googleMutant({
            type: 'roadmap'
        }).addTo(map);
        } else {
        var roads = L.gridLayer.googleMutant({
            type: 'satellite'
        }).addTo(map);
        }
    });
  </script>
{% endblock%}